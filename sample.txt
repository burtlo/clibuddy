# The 'flow' section defines what happens when you run the command
# with the given arguments. So for the first one, when you run
#  mocked chef-do --help, the mock tool will show usage as defined in the
# 'command' section
command
  chef-do
    flow
      when run with --help
        .show usage
      when run with example.com my-stakc
        .show error STACKFILE001
      when run with bad+host.com *
        .show error STACKNET001
      when run with example.com my-stack
        .spinner [HOST] Connecting...
          .success after 1s .success Connected
        .spinner [HOST] Checking for existing Chef installation
          .success after 1s Chef already installed!
          # Also supported: .update after...
        .spinner [HOST] Uploading stack
          .success after 0.5s [HOST] Stack uploaded.
        .spinner [HOST] Applying stack
          .success after 2s [HOST] Stack applied!
        .check Workstation updated in 8.04 seconds!
      when run with "example.com short-stack"
        .spinner [HOST] Connecting...
          .success after 1s Connected
        .spinner [HOST] Checking for existing Chef installation
          .success after 1s Chef already installed!
        .spinner [HOST] Uploading stack
          .success after 0.5s [HOST] Stack uploaded.
        .spinner [HOST] Applying stack
          .failure after 2s [HOST] An error occurred when applying #{STACKNAME}
        .show error STACKAPPLY001
      when run with "my-host-group short-stack"
        .parallel
          .spinner Connecting to host1
            .after 1s Connected, applying STACKNAME to host1
            .after 1s .success host1 updated
          .spinner Connecting to host2
            .after 2s Connected, Applying STACKNAME to host2
            .after 1s .success host2 updated
          .spinner
            .after 1s Connecting to host2
            .after 1s Applying STACKNAME to host2
            .after 1s .failure an error happened on host2
          .failure "Some nodes had had problems."
    definition
      HOST
        the host, IP or host group to apply changes to
      STACK
        the name of a stack to apply, or the path to a stack file
      --*help
        shows usage details for this command
      --*params-file FILE
        the path to a file containing parameter overrides. Defaults to STAK_FILE.params
      --*key-file FILE
        the path to a key file for authenticating over SSH to the remote host
      --use-*supermarket [URL]
    usage
      short
        Apply STACK to HOST
      full
        Update the HOST given to the state specified in the
        stak provided.

# Here we define the commands, usage, and flags.
# Arguments should be in all capital letters.  If an argument name appears
# in message text in the mocks above, it will be replaced with what was provided
# for that argument
# eg, if 'chef-do example.com my-stack' is used, then any time we see
# HOST in the flow above, it will be replaced with 'example.com'
# 'usage' section details the arguments and their descriptions. this is used to
# generate the mock interface.
# flags (--some-flag) that have '*' present will use the next letter as their 'short'
# option.  So in this case "chef-do -h" or "chef-do --help" will show command usage.
command chef-do

# Errors that you want to show from the 'flow' section must be defined here.
# They can be named whatever you wish.  The first line is a short description of the error,
# and the remaining lines are detailed information and remediation steps.
# errors.  Argument names (like HOST) have their values substituted in (eg "example.com") into the message
# text.

errors
  STACKFILE001
    The specified stack could not be found.

    The stack BLUE 'STACK' could not be found. Please
    verify that BLUE 'STACK' is the correct name; otherwise,
    use the -s flag to allow shak to connect to Supermarket
    to find additional possible matches.
    .end-error

  STACKNET001
    Could not connect to host

    The host 'HOST' could not be found.  Please verify that the
    host name is correct, and that -- if necessary - you are connected
    to any required VPNs.

    Error received: Name or service not known
    .end-error

  STACKAPPLY001
    Error applying STACKNAME to HOST.

    The following error occurred when applying this stack:

      RED Resource not found: ....

    .end-error
